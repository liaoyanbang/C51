C51 COMPILER V9.60.0.0   MUSIC                                                             05/13/2021 21:46:35 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MUSIC
OBJECT MODULE PLACED IN music.OBJ
COMPILER INVOKED BY: D:\Keil_v5\44444444444\C51\BIN\C51.EXE music.c COMPACT OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND 
                    -TABS(2)

line level    source

   1          /***************
   2          author：zc
   3          description： 蜂鸣器播放音乐 天空之城
   4                  晶振11.0592Mhz
   5                  实现方法：
   6                      while(1)循环中生成音调方波；
   7                    定时器1记录每个音调的时长并切换音调
   8          ****************/
   9          
  10          #include "music.h"
  11          unsigned int tones[]=          //C调音调
  12          {
  13          3816,3401,3030,2865,2551,2272,2024,  //低音
  14          1912,1703,1517,1432,1275,1136,1012,  //中音
  15          965, 851, 758, 715, 605, 538, 466  //高音
  16          };
  17          
  18          unsigned char code sky[]={       //谱子
  19          //格式： 音调， 音度， 拍数
  20          //例： 4，1，1 //音调fa，中音，时长半拍
  21          //0代表空音
  22          0,0,2,
  23          0,0,2,
  24          0,0,2,
  25          6,1,1,
  26          7,1,1,
  27          
  28          1,2,3,
  29          7,1,1,
  30          1,2,2,
  31          3,2,2,
  32          
  33          7,1,4,
  34          0,2,2,
  35          3,1,1,
  36          3,1,1,
  37          
  38          6,1,3,
  39          5,1,1,
  40          6,1,2,
  41          1,2,2,
  42          
  43          5,1,4,
  44          0,1,2,
  45          3,1,2,
  46          
  47          4,1,3,
  48          3,1,1,
  49          4,1,2,
  50          1,2,2,
  51          
  52          3,1,3,
  53          0,0,1,
  54          1,2,1,
C51 COMPILER V9.60.0.0   MUSIC                                                             05/13/2021 21:46:35 PAGE 2   

  55          1,2,1,
  56          1,2,1,
  57          
  58          7,1,3,
  59          4,1,1,
  60          4,1,2,
  61          7,1,2,
  62          
  63          7,1,4,
  64          0,0,2,
  65          6,1,1,
  66          7,1,1,
  67          
  68          1,2,3,
  69          7,1,1,
  70          1,2,2,
  71          3,2,2,
  72          
  73          7,1,4,
  74          0,0,2,
  75          3,1,1,
  76          3,1,1,
  77          
  78          6,1,3,
  79          5,1,1,
  80          6,1,2,
  81          1,2,2,
  82          
  83          5,1,4,
  84          0,0,2,
  85          2,1,1,
  86          3,1,1,
  87          
  88          4,1,2,
  89          1,2,1,
  90          7,1,2,
  91          1,2,3,
  92          
  93          2,2,1,
  94          2,2,1,
  95          3,2,1,
  96          1,2,3,
  97          0,0,2,
  98          
  99          1,2,1,
 100          7,1,1,
 101          6,1,1,
 102          6,1,1,
 103          7,1,2,
 104          5,1,2,
 105          
 106          6,1,4,
 107          0,0,2,
 108          1,2,1,
 109          2,2,1,
 110          
 111          3,2,3,
 112          2,2,1,
 113          3,2,2,
 114          5,2,2,
 115          
 116          2,2,4,
C51 COMPILER V9.60.0.0   MUSIC                                                             05/13/2021 21:46:35 PAGE 3   

 117          0,0,2,
 118          5,1,1,
 119          5,1,1,
 120          
 121          1,2,3,
 122          7,1,1,
 123          1,2,2,
 124          3,2,2,
 125          
 126          3,2,4,
 127          0,0,2,
 128          
 129          6,1,1,
 130          7,1,1,
 131          1,2,2,
 132          7,1,2,
 133          2,2,1,
 134          2,2,1,
 135          
 136          1,2,3,
 137          5,1,1,
 138          5,1,3,
 139          0,0,1,
 140          
 141          4,2,2,
 142          3,2,2,
 143          2,2,2,
 144          1,2,2,
 145          
 146          3,2,4,
 147          0,0,2,
 148          3,2,2,
 149          
 150          6,2,4,
 151          5,2,2,
 152          5,2,2,
 153          
 154          3,2,1,
 155          2,2,1,
 156          1,2,4,
 157          0,2,1,
 158          1,2,1,
 159          
 160          2,2,2,
 161          1,2,1,
 162          2,2,1,
 163          2,2,2,
 164          5,2,2,
 165          
 166          3,2,4,
 167          0,2,2,
 168          3,2,2,
 169          
 170          
 171          6,2,4,
 172          5,2,4,
 173          
 174          3,2,1,
 175          2,2,1,
 176          1,2,4,
 177          0,0,1,
 178          1,2,1,
C51 COMPILER V9.60.0.0   MUSIC                                                             05/13/2021 21:46:35 PAGE 4   

 179          
 180          2,2,2,
 181          1,2,1,
 182          2,2,1,
 183          2,2,2,
 184          7,1,2,
 185          
 186          6,1,2,
 187          };
 188          
 189          sbit  Buzzer=P3^7;               //定义buzzer引脚
 190          
 191          unsigned char s=0, t_tone=0;       //s用作定时器计时， t_tone保存音调时长
 192          unsigned int  tone=0;          //tone保存音调，
 193          char *tone_p=sky;          //指针指向要播放的曲目
 194          
 195          
 196          
 197          void time_init( void )
 198          {
 199   1        TMOD|=0x10;            //使用定时器1
 200   1        TH1=(65536-65000)/256;       //装初值
 201   1        TL1=(65536-65000)%256;
 202   1        EA =  1;             //开中断，打开定时器开关
 203   1        ET1 = 1;
 204   1        TR1 = 1;
 205   1      }
 206          
 207          void timer1( void ) interrupt 3    //定时器1 中断
 208          {
 209   1        TH1=(65536-50000)/256;       //装初值
 210   1        TL1=(65536-50000)%256;
 211   1        s++;
 212   1        if(s>=4*t_tone)          //一个音节播放的时间，这里可以通过调t_tone前的系数可以改变时长
 213   1        {
 214   2          s=0;             //讲计时器清零
 215   2          if((*tone_p)!=0)       //如果音不是0
 216   2            tone = tones[*tone_p+7*(*(tone_p+1))-1];  //赋值音调
 217   2          else 
 218   2            tone = 0;          //关了蜂鸣器
 219   2          t_tone = *(tone_p+2);    //取时间啊
 220   2          tone_p+=3;           //移动指针
 221   2          delay_ms(100);         //延时一下，不延时特别难听
 222   2        }
 223   1      } 
 224          
 225          
 226          void play_tone(unsigned int tone)  //播音调函数，就是方波发生器
 227          {
 228   1      
 229   1          Buzzer=!Buzzer;        
 230   1          delay_us(tone);   
 231   1      }
 232          
 233          void delay_ms(unsigned int t)    //毫秒延时12MHz下
 234          {
 235   1        unsigned int i=0;
 236   1        while(t--)
 237   1          for(i=0;i<75;i++);
 238   1      }
 239          
 240          void delay_us(unsigned int t)    //us延时 12MHz下
C51 COMPILER V9.60.0.0   MUSIC                                                             05/13/2021 21:46:35 PAGE 5   

 241          {
 242   1        t/=10;
 243   1        for(t;t;t--);
 244   1      }
 245          
 246          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    256    ----
   CONSTANT SIZE    =    396    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =     49    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
